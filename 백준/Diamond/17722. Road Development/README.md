# [Diamond V] Road Development - 17722 

[문제 링크](https://www.acmicpc.net/problem/17722) 

### 성능 요약

메모리: 171204 KB, 시간: 1836 ms

### 분류

자료 구조, 분리 집합, Heavy-light 분할, 느리게 갱신되는 세그먼트 트리, 오프라인 쿼리, 세그먼트 트리, 트리

### 제출 일자

2025년 6월 4일 13:19:14

### 문제 설명

<p>IOI 国は，N 個の都市からなる国である．これらの都市には 1, 2, . . . , N の番号がついている．JOI 教授 は，IOI 国の道路網が整備された過程について興味を持った．</p>

<p>JOI 教授が，IOI 国の歴史に関する資料を調べたところ，以下のことが分かった．</p>

<ul>
	<li>IOI 国の都市は建国直後から現在まで同じである．IOI 国の建国直後には都市を結ぶ道路は一つもな かった．</li>
	<li>IOI 国の建国 i 年後 (1 ≦ i ≦ Q) には，都市 A<sub>i</sub> と都市 B<sub>i</sub> の間の交通状況の改善計画が立てられた．</li>
	<li>計画された改善計画のうちのいくつかは計画通り実行されたが，実行されずに放棄された計画もある．</li>
	<li>どの改善計画が実行されたかは，資料から明らかになっている．</li>
	<li>実行された改善計画は，すべて 1 年以内に実行が完了した．</li>
</ul>

<p>また，別の文献から，都市 A<sub>i</sub> と都市 B<sub>i</sub> の間の交通状況の改善計画は次のようなものであることが分 かった．</p>

<ul>
	<li>改善計画が立てられた時点で建設済みの道路を用いて都市 A<sub>i</sub> から都市 B<sub>i</sub> に移動できない場合は，都 市 A<sub>i</sub> と都市 B<sub>i</sub> を双方向に結ぶ道路を新たに建設する．新たに建設された道路は未舗装である．</li>
	<li>改善計画が立てられた時点で建設済みの道路を用いて都市 A<sub>i</sub> から都市 B<sub>i</sub> に移動できる場合は，その ような経路のうち用いる道路の本数が最小となるものについて，その経路に含まれる未舗装の道路 をすべて舗装する．用いる道路の本数が最小となる経路が複数ある場合は，それらの経路すべてに対 して同じように未舗装の道路を舗装する．一度舗装した道路を，もう一度舗装することはない．</li>
</ul>

<p>JOI 教授は，さらなる調査のため，実行されずに放棄された改善計画それぞれに対して，もしその改善 計画のみが追加で実行されていたら，その改善計画において何本の道路を舗装することになっていたかを 計算することにした．</p>

<p>IOI 国の交通状況の改善計画とその実行状況が与えられたとき，実行されずに放棄された改善計画それ ぞれに対して，もしその改善計画が実行されていたら，その改善計画において何本の道路を舗装すること になっていたかを計算するプログラムを作成せよ．</p>

### 입력 

 <p>標準入力から以下のデータを読み込め．</p>

<ul>
	<li>1 行目には，整数 N, Q が空白を区切りとして書かれている．これは，IOI 国に都市が N 個あり，JOI 教授が建国から Q 年間の交通状況の改善計画に注目していることを表す．</li>
	<li>続く Q 行のうちの i 行目 (1 ≦ i ≦ Q) には，3 つの整数 Ti , A<sub>i</sub>, B<sub>i</sub> が空白を区切りとして書かれている． 整数 T<sub>i</sub> は，建国 i 年後に立てられた改善計画の実行状況を表し，T<sub>i</sub> = 1 の時はその改善計画が実行 されたことを，T<sub>i</sub> = 2 の時はその改善計画が実行されずに放棄されたことを表す．また，整数 A<sub>i</sub>, B<sub>i</sub> は，建国 i 年後に都市 A<sub>i</sub> と都市 B<sub>i</sub> の間の交通状況の改善計画が立てられたことを表す．</li>
</ul>

### 출력 

 <p>標準出力に，実行されずに放棄された改善計画それぞれに対し，もしその改善計画が実行されていたら， その改善計画において舗装することになる道路の本数を 1 行で出力せよ．ただし，その改善計画を実行す ると新しい道路が建設される場合は，-1 を出力せよ．</p>

