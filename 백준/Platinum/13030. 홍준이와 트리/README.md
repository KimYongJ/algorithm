# [Platinum II] 홍준이와 트리 - 13030 

[문제 링크](https://www.acmicpc.net/problem/13030) 

### 성능 요약

메모리: 192296 KB, 시간: 1216 ms

### 분류

자료 구조, 오일러 경로 테크닉, 느리게 갱신되는 세그먼트 트리, 세그먼트 트리, 트리

### 제출 일자

2025년 2월 25일 13:12:14

### 문제 설명

<p>1번 정점이 루트인 N개의 정점으로 구성된 트리가 주어진다.</p>

<p>처음에 모든 정점들은 0의 가중치를 가지고 있다. Q의 쿼리가 주어진다. 쿼리는 다음 2가지 중 하나이다.</p>

<ul>
	<li>유형 1: 입력으로 “1 v x k”가 주어진다. 정점 v의 가중치에 x를 더한다. 정점 v와 거리가 1인 모든 자식 노드들의 가중치에는 x-k를 더한다. 정점 v와 거리가 i(i>1)인 모든 자식 노드들의 가중치에는 x-(i × k)만큼을 더한다. (1 ≤ v ≤ n, 0 ≤ x, k < 10<sup>9</sup>+7)</li>
	<li>유형 2: 입력으로 “2 v”가 주어진다. 정점 v의 가중치를 10<sup>9</sup>+7로 나눈 나머지를 출력한다. (1 ≤ v ≤ n)</li>
</ul>

### 입력 

 <p>첫 번째 줄에 정점의 개수 N(1≤N≤300000)과 쿼리의 개수 Q(1≤Q≤300000)가 주어진다.</p>

<p>둘째 줄에 N-1개의 정수 p<sub>2</sub>, p<sub>3</sub>, ... , p<sub>n</sub>이 주어진다. p<sub>k</sub>(1 ≤ p<sub>k</sub>  < k)는 정점 k의 부모를 나타낸다.</p>

<p>셋째 줄부터 Q개의 줄에 걸쳐 쿼리가 주어진다. 각 쿼리의 첫 번째 정수 q는 1 또는 2의 값을 가지는 정수인데, 해당 쿼리가 어느 유형에 속하는지를 알려주는 값이다. 이후 해당 유형에 따른 정보가 주어진다.</p>

### 출력 

 <p>유형 2가 입력으로 주어질 때마다 유형 2의 결과를 출력한다.</p>

